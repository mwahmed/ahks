<%- model_class = Transcription -%>
<div class="row-fluid">
    <div class="span3">
      <div class="sidebar-nav">
        <div class="well"> 
          <%= form_tag transcriptions_path, :method => :get do %>
            <p>
              <%= text_field_tag :search, params[:search] %>
              <%= submit_tag "Search", :name => nil, :class=>"btn btn-large btn-primary" %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="span6">
      <div class="page-header">
        <h1><%=t '.title', :default => model_class.model_name.human.pluralize.titleize %></h1>
	      <%= link_to t('.new', :default => t("helpers.links.new")),
                  new_transcription_path,
                  :class => 'btn btn-primary' %>

      </div>
      <table class="table table-striped table-hover table-condensed">
        <thead>
          <tr>
            <th><%= model_class.human_attribute_name(:name) %></th>
            <th><%= model_class.human_attribute_name(:description) %></th>
            <th>Transcription Text</th>
            <th>Last Modified</th>
            
            <th><%=t '.actions', :default => t("helpers.actions") %></th>
          </tr>
        </thead>
        <tbody>
          <% @transcriptions.each do |transcription| %>
            <tr>
              <td><%= link_to transcription.name, "/transcriptions/#{transcription.id}?q=#{params[:search]}"%></td>
              <td><%= transcription.description %></td>
		<% if !params[:search].nil?%>
			<td>
			<table>
			<% i=0 %>
			<% truncate(transcription.text, length: 250).split("\n").each do |t|%>
			<tr>
			<td> <%=i%>:00-<%=i+2%>:00 <% i+=2%></td>
			<td> <%= highlight(t, params[:search].split) %>
			</td>

			</tr>
			<% end %>
			<%= link_to "Read More", "/transcriptions/#{transcription.id}?q=#{params[:search]}"%>
			</table>
			
			</td>
		<% else %>
              <td><% if transcription.text.length>250 %>
			<%= truncate(transcription.text.to_s.gsub("\n",". "), length: 250) %> <%= link_to "Read More", "/transcriptions/#{transcription.id}?q=#{params[:search]}"%>
		    <% else %>
			<%= transcription.text.to_s.gsub("\n",". ")%>
		    <% end %>
		</td>
		<% end %>
              <td><%= transcription.date_created %></td>
             
              <td>
                <%= link_to t('.edit', :default => t("helpers.links.edit")),
                            edit_transcription_path(transcription), :class => 'btn btn-mini' %>

                <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                            transcription_path(transcription),
                            :method => :delete,
                            :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                            :class => 'btn btn-mini btn-danger' %>

		

<div class="panel-group" id="accordion<%=transcription.id%>">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion<%=transcription.id%>" href="#collapseOne<%=transcription.id%>">
		Summary
        </a>
      </h4>
    </div>
    <div id="collapseOne<%=transcription.id%>" class="panel-collapse collapse ">
      <div class="panel-body">
      	<%= form_tag summary_path, :method => :get do %>
                      
		<table>
		<tr>
		    	<td> <p> Length </p></td>
			<td>	<%= text_field_tag :summary_length, params[:summary_length], :class => "form-control", :placeholder=>"50" %> </td>

		</tr>

                <tr>
                        <td> <p> Words to match </p></td>
                        <td>    <%= text_field_tag :zwords, params[:zwords], :class => "form-control", :placeholder=>"developer, big data" %> </td>

                </tr>
                <tr>
                        <td> <p> Words to ignore </p></td>
                        <td>    <%= text_field_tag :antiz, params[:antiz], :class => "form-control", :placeholder=>"sales, distribution" %> </td>

                </tr>


                      	<%= hidden_field_tag 'id', transcription.id.to_s %>

		</table>
                      <%= submit_tag "Submit", :name => nil, :class=>"btn btn-mini btn-primary" %>
                  <% end %>


      </div>
    </div>
  </div>
</div>
             <table> <tr><td>      
	
	      <%= link_to 'Present Deliverables', deliverables_path(id: transcription.id, type:'present'), :class => 'btn btn-primary'  %>
		</td><td>
	      <%= link_to "Future Deliverables",  deliverables_path(id: transcription.id, type:'future'),
                  :class => 'btn btn-primary' %>
		</td></tr></table>
		
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <%= link_to t('.new', :default => t("helpers.links.new")),
                  new_transcription_path,
                  :class => 'btn btn-primary' %>
    </div>

</div>
<div class="container">

</div>
