<%- model_class = Document -%>
<script type="text/javascript"> 
$(document).ready(function(){
  $("table").tablecloth({
    theme: "default",
    bordered: false,
    condensed: true,
    hover:true,
    responsive: true,
    striped: true,
    sortable: true,
    clean: true,
    cleanElements: "th td",
    customClass: "my-table"
  });
  });

</script>
<div class="row-fluid">
   <div class="span2">
      <div class="sidebar-nav">
         <div class="well">
            <%= form_tag documents_path, :method => :get do %>
               <%= text_field_tag :search, params[:search] %>
               <%= submit_tag "Search", :name => nil, :class=>"btn btn-large btn-primary" %>
            <% end %>
         </div>
      </div>
   </div>
   <div class="span10">
      <div class="page-header">
         <h1><%=t '.title', :default => model_class.model_name.human.pluralize.titleize %></h1>
         <%= link_to t('.new', :default => t("helpers.links.new")),
            new_document_path,
            :class => 'btn btn-primary' %>
      </div>
      <table id="table" class="table table-striped table-hover table-condensed table-responsive">
         <thead>
            <tr>
               <th><%= model_class.human_attribute_name(:title) %></th>
               <th><%= model_class.human_attribute_name(:description) %></th>
               <th>Data</th>
               <th>Last Modified</th>
               <th><%=t '.actions', :default => t("helpers.actions") %></th>
            </tr>
         </thead>
         <tbody id="myTable">
            <% @documents.each do |document| %>
            <tr>
               <td><%= link_to document.title, "/documents/#{document.id}?q=#{params[:search]}"%></td>
               <td>
                  <% if document.description.length>100 %>
                     <%= truncate(document.description.to_s, length: 100) %> <%= link_to "more", "/documents/#{document.id}?q=#{params[:search]}"%>
                  <% else %>
                     <%= document.description.to_s%>
                  <% end %>
               </td>
               <% if !params[:search].nil?%>
               <td>
                     
                     
                    <%= highlight(truncate(document.data, length: 250), params[:search].split) %>
                     
                    
                    <%= link_to "more", "/documents/#{document.id}?q=#{params[:search]}"%>
                  
               </td>
               <% else %>
               <td><% if document.data.length>250 %>
                  <%= truncate(document.data, length: 250) %> <%= link_to "more", "/documents/#{document.id}?q=#{params[:search]}"%>
                  <% else %>
                  <%= document.data.to_s %>
                  <% end %>
               </td>
               <% end %>
               <td><%= document.date_created.to_time.strftime('%e %b, %y at %I:%M %p') %></td>
               <td>
                  <%= link_to t('.edit', :default => t("helpers.links.edit")),
                     edit_document_path(document), :class => 'btn btn-mini' %>
                  <div class="btn-group">
                     <a class="btn dropdown-toggle btn-mini" data-toggle="dropdown" href="#">
                     Deliverables
                     <span class="caret"></span>
                     </a>
                     <ul class="dropdown-menu">
                        <li> <%= link_to 'Present', deliverables_path(id: document.id, type:'present')  %> </li>
                        <li> <%= link_to "Future",  deliverables_path(id: document.id, type:'future')   %> </li>
                     </ul>
                  </div>
                  <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                     document_path(document),
                     :method => :delete,
                     :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                     :class => 'btn btn-mini btn-danger' %>
                  <div class="panel-group" id="accordion<%=document.id%>">
                     <div class="panel panel-default">
                        <div class="panel-heading">
                           <h4 class="panel-title">
                              <a data-toggle="collapse" data-parent="#accordion<%=document.id%>" href="#collapseOne<%=document.id%>">
                              Summary
                              </a>
                           </h4>
                        </div>
                        <div id="collapseOne<%=document.id%>" class="panel-collapse collapse ">
                           <div class="panel-body">
                              <%= form_tag doc_summary_path, :method => :get do %>
                              <table>
                                 <tr>
                                    <td>
                                       <p> Length </p>
                                    </td>
                                    <td> 
                                       <%= text_field_tag :summary_length, params[:summary_length], :class => "form-control", :placeholder=>"50" %> 
                                    </td>
                                 </tr>
                                 <tr>
                                    <td>
                                       <p> Words to match 
                                       </p>
                                    </td>
                                    <td>    
                                       <%= text_field_tag :zwords, params[:zwords], :class => "form-control", :placeholder=>"developer, big data" %> 
                                    </td>
                                 </tr>
                                 <tr>
                                    <td>
                                       <p> Words to ignore 
                                       </p>
                                    </td>
                                    <td>    
                                       <%= text_field_tag :antiz, params[:antiz], :class => "form-control", :placeholder=>"sales, distribution" %> 
                                    </td>
                                 </tr>
                                 <%= hidden_field_tag 'id', document.id.to_s %>
                              </table>
                              <%= submit_tag "Submit", :name => nil, :class=>"btn btn-primary" %>
                              <% end %>
                           </div>
                        </div>
                     </div>
                  </div>
                  <p> 
                        <%document.tags.each do |tag|%>
                        <div style="float:left;margin-right:2px;margin-top:0px;">
                           <%= button_to "#{tag.name}", tag, :method => "get", :class => "btn-tags btn btn-small" %>
                        </div>
                     <%end%>
                  </p>
               </td>
            </tr>
            <% end %>
         </tbody>
      </table>
            <%= link_to t('.new', :default => t("helpers.links.new")),
         new_document_path,
         :class => 'btn btn-primary' %>
         <div class="text-center">
            <ul class="pagination" id="myPager"></ul>
            </div>
         </div>
      

      
   </div>
</div>
